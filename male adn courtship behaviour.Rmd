---
title: "**Male courtship behaviour - aDN > TNT**"
author: "Aaron M. Allen"
date: "24 February 2020"
output: html_notebook
---

<br/>
<br/>

# **Setup**

```{r message=FALSE}
library("tidyverse")
library("ggpubr")
library("zoo")
setwd("/mnt/LocalData/behaviour/aDN/aDN_behaviour")
```


<br/>
<br/>


### Colours ...
 
```{r}
gg_color_hue <- function(n) {
  hues = seq(15, 375, length = n + 1)
  hcl(h = hues, l = 65, c = 100)[1:n]
}
```

```{r}
gg_color_hue(2)
```



<br/>
<br/>



```{r message=FALSE}
genotypes <- read_tsv("../2019_03_06_Courtship/genotype.tsv",col_names = TRUE)
genotypes
```



<br/>
<br/>






```{r message=FALSE}
# indices_list <- list.files("raw data/") %>% str_subset("_Indices.csv")
indices_list <- list.files("../2019_03_06_Courtship/",recursive = TRUE) %>% str_subset("_Indices.csv") %>% str_subset("Male")
all_indices <- tibble()
for (indices_file in indices_list) {
  video_name <- indices_file %>% str_remove("/.*")
  temp <- read_csv(paste0("../2019_03_06_Courtship/",indices_file))
  temp <- temp %>%
    mutate(video = video_name)
  all_indices <- bind_rows(all_indices,temp)
}
all_indices
```




```{r message=FALSE}
all_male_indices <- left_join(x = genotypes,y = all_indices,by=c("video"="video","fly_id"="FlyId"))
```




```{r}
all_male_indices %>% 
  group_by(genotype) %>% 
  summarise(n = length(genotype))
```

```{r}
unique(all_male_indices$genotype)
```



<br/>
<br/>



```{r message=FALSE}
ggplot(all_male_indices,aes(x=genotype,y=CourtshipIndexWithFacing)) + 
  geom_boxplot()
```


<br/>
<br/>



```{r message=FALSE, fig.width=12, fig.height=3}
p1 <- ggplot(all_male_indices,aes(x=genotype,y=CourtshipIndex)) + 
  geom_boxplot()
p2 <- ggplot(all_male_indices,aes(x=genotype,y=CourtshipIndexWithFacing)) + 
  geom_boxplot()
p3 <- ggplot(all_male_indices,aes(x=genotype,y=TotalCCI)) + 
  geom_boxplot()
p4 <- ggplot(all_male_indices,aes(x=genotype,y=TotalCCIwFacing)) + 
  geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3,p4),
          # labels = c("ApproachingIndex",
          #            "ContactIndex",
          #            "EncirclingIndex",
          #            "FacingIndex",
          #            "TurningIndex",
          #            "WingIndex"),
          # hjust = 1,
          ncol = 4,
          nrow = 1)
```


<br/>
<br/>




```{r message=FALSE, fig.width=12, fig.height=8}
p1 <- ggplot(all_male_indices,aes(x=genotype,y=ApproachingIndex)) + 
  geom_boxplot()
p2 <- ggplot(all_male_indices,aes(x=genotype,y=ContactIndex)) + 
  geom_boxplot()
p3 <- ggplot(all_male_indices,aes(x=genotype,y=EncirclingIndex)) + 
  geom_boxplot()
p4 <- ggplot(all_male_indices,aes(x=genotype,y=FacingIndex)) + 
  geom_boxplot()
p5 <- ggplot(all_male_indices,aes(x=genotype,y=TurningIndex)) + 
  geom_boxplot()
p6 <- ggplot(all_male_indices,aes(x=genotype,y=WingIndex)) + 
  geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3,p4,p5,p6),
          # labels = c("ApproachingIndex",
          #            "ContactIndex",
          #            "EncirclingIndex",
          #            "FacingIndex",
          #            "TurningIndex",
          #            "WingIndex"),
          # hjust = 1,
          ncol = 3,
          nrow = 2)
```



<br/>
<br/>





```{r message=FALSE, fig.width=10, fig.height=4}
p1 <- ggplot(all_male_indices,aes(x=genotype,y=CourtshipInitiation)) + 
  geom_boxplot()
p2 <- ggplot(all_male_indices,aes(x=genotype,y=CourtshipTermination)) + 
  geom_boxplot()
p3 <- ggplot(all_male_indices,aes(x=genotype,y=CourtshipDuration)) + 
  geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3),
          ncol = 3,
          nrow = 1)
```


<br/>
<br/>



```{r message=FALSE}
df <- all_male_indices %>%
  select(genotype,CourtshipTermination) %>% 
  group_by(genotype) %>% 
  mutate(len=length(CourtshipTermination))
#ggplot(df,aes(x=CourtshipTermination,color=genotype)) + geom_step(aes(len=len,y=..y.. * len),stat="ecdf") 
ggplot(df,aes(x=CourtshipTermination,color=genotype)) + geom_step(aes(y=..y..),stat="ecdf")
```


<br/>
<br/>



```{r message=FALSE}
df <- all_male_indices %>%
  select(genotype,CourtshipDuration) %>% 
  group_by(genotype) %>% 
  mutate(len=length(CourtshipDuration))
#ggplot(df,aes(x=CourtshipDuration,color=genotype)) + geom_step(aes(len=len,y=..y.. * len),stat="ecdf") 
ggplot(df,aes(x=CourtshipDuration,color=genotype)) + geom_step(aes(y=..y..),stat="ecdf")
```




<br/>
<br/>




```{r message=FALSE, warning=FALSE, fig.width=16, fig.height=8}
p1 <- ggplot(all_male_indices,aes(x=genotype,y=ApproachingBoutLength)) + 
  geom_boxplot()
p2 <- ggplot(all_male_indices,aes(x=genotype,y=ContactBoutLength)) + 
  geom_boxplot()
p3 <- ggplot(all_male_indices,aes(x=genotype,y=EncirclingBoutLength)) + 
  geom_boxplot()
p4 <- ggplot(all_male_indices,aes(x=genotype,y=FacingBoutLength)) + 
  geom_boxplot()
p5 <- ggplot(all_male_indices,aes(x=genotype,y=TurningBoutLength)) + 
  geom_boxplot()
p6 <- ggplot(all_male_indices,aes(x=genotype,y=WingBoutLength)) + 
  geom_boxplot()
p7 <- ggplot(all_male_indices,aes(x=genotype,y=ApproachingBoutInterval)) + 
  geom_boxplot()
p8 <- ggplot(all_male_indices,aes(x=genotype,y=ContactBoutInterval)) + 
  geom_boxplot()
p9 <- ggplot(all_male_indices,aes(x=genotype,y=EncirclingBoutInterval)) + 
  geom_boxplot()
p10 <- ggplot(all_male_indices,aes(x=genotype,y=FacingBoutInterval)) + 
  geom_boxplot()
p11 <- ggplot(all_male_indices,aes(x=genotype,y=TurningBoutInterval)) + 
  geom_boxplot()
p12 <- ggplot(all_male_indices,aes(x=genotype,y=WingBoutInterval)) + 
  geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3,p4,p5,p6,
                          p7,p8,p9,p10,p11,p12),
          # labels = c("ApproachingIndex",
          #            "ContactIndex",
          #            "EncirclingIndex",
          #            "FacingIndex",
          #            "TurningIndex",
          #            "WingIndex"),
          # hjust = 1,
          ncol = 6,
          nrow = 2)
```











<br/>
<br/>
<br/>
<br/>











```{r message=FALSE, echo=FALSE, warning=FALSE}
rawdata_list <- list.files("../",recursive = TRUE) %>% str_subset("_ALLDATA.csv") %>% str_subset("_Male_")
all_rawdata <- tibble()
for (rawdata_file in rawdata_list) {
  temp <- read_csv(paste0("../",rawdata_file),progress = FALSE)
  all_rawdata <- bind_rows(all_rawdata,temp)
}
```



```{r message=FALSE}
all_rawdata <- all_rawdata %>%
  full_join(x = all_rawdata, y = genotypes, by = c("FileName"="video","Id"="fly_id")) %>% 
  replace_na(list(genotype = "CS female"))
all_rawdata
```





<br/>
<br/>







```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Arena == 2) %>% 
  filter(Id == 3) %>% 
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4"))
  
```


<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Arena == 2) %>% 
  filter(Id == 3) %>% 
  filter(dist_to_other__mm > 2) %>% 
  ggplot() +
    geom_density(aes(x=wing_l_ang__rad, colour = "#F8766D"),size = 2) +
    geom_density(aes(x=wing_r_ang__rad, colour = "#00BFC4"),size = 2)
```



<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Arena == 2) %>% 
  filter(Id == 3) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>% 
  ggplot() +
    geom_density(aes(x=wing_l_ang__rad, colour = "#F8766D"),size = 2) +
    geom_density(aes(x=wing_r_ang__rad, colour = "#00BFC4"),size = 2)
```








```{r}
# # Extract density data to average
# p <- ggplot_build(test_plot)
# ggplot(as.data.frame(p$data[[1]]), aes(x,y)) + geom_line()
# ggplot(as.data.frame(p$data[[2]]), aes(x,y)) + geom_line()
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "A") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=max_wing_ang__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none")
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "B") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=max_wing_ang__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none")
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "C") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=max_wing_ang__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none")
```



<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "D") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=max_wing_ang__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none")
```



<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 3) %>% 
  ggplot(aes(x=Frame,y=angle_between__rad)) +
    geom_point()
```





<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Arena == 2) %>% 
  ggplot(aes(x=Frame,y=facing_angle__rad, color=as_factor(Id))) +
    geom_point()
```




<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Arena == 2) %>% 
  ggplot() +
    geom_density(aes(x=facing_angle__rad, color=as_factor(Id)),size = 2)
```





<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "A") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=facing_angle__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(unique_fly == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6_17") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  ggplot(aes(x=facing_angle__rad,colour=unique_fly)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(unique_fly == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6_17") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  ggplot(aes(x=Frame,y=facing_angle__rad,colour=unique_fly)) +
    geom_point() + theme(legend.position = "none") #+
    #ylim(0,6)
```

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(unique_fly == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6_17") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  ggplot(aes(x=Frame,y=dist_to_other__mm,colour=unique_fly)) +
    geom_point() + theme(legend.position = "none") #+
    #ylim(0,6)
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(unique_fly == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6_17") %>% 
  filter(SmoothedCopulation == 0) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  ggplot(aes(x=facing_angle__rad,colour=unique_fly)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(unique_fly == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6_17") %>% 
  filter(Frame < 5000) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  ggplot(aes(x=facing_angle__rad,colour=unique_fly)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(unique_fly == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6_17") %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther>0.5,"not copulating","copulating"))))+
    geom_point(aes(y=c(ifelse(SmoothedCopulation==1,SmoothedCopulation+6,NA))))+
    geom_point(aes(y=c(ifelse(Copulation==1,Copulation+7,NA))))
```














```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "A") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  summarise(id = unique(unique_fly),
            facing = mean(facing_angle__rad))  
```














```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "B") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=facing_angle__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "C") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=facing_angle__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```



<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "D") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=facing_angle__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```



<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "A") %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=facing_angle__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "D") %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=facing_angle__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6)
```




<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Arena == 2) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm, color=dist_to_other__mm)) +
    geom_point() 
```


<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 3) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(dist_to_other__mm>2,"not copulating","copulating"))))
```





<br/>
<br/>


<br/>
<br/>






### D genotype distance to other

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 27) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(dist_to_other__mm>2,"not copulating","copulating"))))
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 29) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(dist_to_other__mm>2,"not copulating","copulating"))))
```


<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 35) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(dist_to_other__mm>2,"not copulating","copulating"))))
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 37) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(dist_to_other__mm>2,"not copulating","copulating"))))
```





<br/>
<br/>





```{r}
all_rawdata <- all_rawdata %>%  
  unite("unique_fly",FileName,Id, remove = FALSE) %>% 
  group_by(unique_fly) %>% 
  mutate(
    Multitasking = (Approaching + Encircling + Contact + Turning + WingGesture),
    MultitaskingWithFacing = (Approaching + Encircling + Facing + Contact + Turning + WingGesture),
    Courtship = ifelse(Multitasking>=1, 1, 0),
    CourtshipWithFacing = ifelse(MultitaskingWithFacing>=1, 1, 0),
    MultitaskingWithCopulation = (Approaching + Encircling + Contact + Turning + WingGesture + Copulation),
    MultitaskingWithCopulationWithFacing = (Approaching + Encircling + Facing + Contact + Turning + WingGesture + Copulation),
    CourtshipAndCopulation = ifelse(MultitaskingWithCopulation>=1, 1, 0),
    CourtshipAndCopulationWthFacing = ifelse(MultitaskingWithCopulationWithFacing>=1, 1, 0),
    SmoothedCourtship = ifelse((rollmean(Courtship, 150, fill = c(0,0,0), align = c("left")))>0.5, 1, 0),
    SmoothedCopulation = ifelse((rollmean(Copulation, 1250, fill = c(0,0,0), align = c("center")))>0.5, 1, 0),
    SmoothedDistToOther = ifelse((rollmean(ifelse(dist_to_other__mm > 2, 1, 0), 250, fill = c(1,1,NA), align = c("center")))>0.5, 1, 0)
)
```






<br/>
<br/>






```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 37) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther==1,"not copulating","copulating"))))
```



<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 37) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=SmoothedDistToOther, colour = "#F8766D")) +
    geom_point(aes(y=(SmoothedCopulation+0.1), colour= "#00BFC4"))
    
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 35) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther==1,"not copulating","copulating"))))
```





<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 35) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=SmoothedDistToOther, colour = "#F8766D")) +
    geom_point(aes(y=(SmoothedCopulation+0.1), colour= "#00BFC4"))
    
```




<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 35) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=SmoothedDistToOther, colour = "#F8766D")) +
    geom_point(aes(y=(SmoothedCopulation+0.1), colour= "#00BFC4")) +
    xlim(2000,3000)
```


<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 35) %>% 
  summarise(which.min(SmoothedDistToOther),
            which.max(SmoothedCopulation))
```








<br/>
<br/>









```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 3) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther==1,"not copulating","copulating"))))
```





<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 3) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedCopulation==0,"not copulating","copulating"))))
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 3) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=SmoothedDistToOther, colour = "#F8766D")) +
    geom_point(aes(y=(SmoothedCopulation+0.1), colour= "#00BFC4")) +
    xlim(6000,7000)
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 3) %>% 
  summarise(which.min(SmoothedDistToOther),
            which.max(SmoothedCopulation))
```























<br/>
<br/>


<br/>
<br/>





### D genotype distance to other

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 27) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther==1,"not copulating","copulating"))))
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 29) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther==1,"not copulating","copulating"))))
```


<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 35) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther>0.5,"not copulating","copulating"))))
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 37) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther==1,"not copulating","copulating"))))
```





















<br/>
<br/>


<br/>
<br/>









```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "D") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=max_wing_ang__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,6) +
    xlim(0,pi)
```




<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "A") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=angle_between__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,3) +
    xlim(0,pi)
```


<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "D") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=angle_between__rad,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,3) +
    xlim(0,pi)
```




<br/>
<br/>








### **Distance to wall**







```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "A") %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=dist_to_wall__mm,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,2.2) +
    xlim(0,10)
```





<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "D") %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=dist_to_wall__mm,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,2.2) +
    xlim(0,10)
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=6}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            mean_dist_to_wall_mm = mean(dist_to_wall__mm[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]
                                 )
            ) %>% 
  ggplot(aes(x=genotype,y=mean_dist_to_wall_mm)) +
    geom_boxplot()
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            median_dist_to_wall_mm = median(dist_to_wall__mm[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]
                                 )
            ) %>% 
  ggplot(aes(x=genotype,y=median_dist_to_wall_mm)) +
    geom_boxplot()
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            prop_dist_to_wall_lt_1 = 100*sum(dist_to_wall__mm[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]<1,
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]
                     )) %>% 
  ggplot(aes(x=genotype,y=prop_dist_to_wall_lt_1)) +
    geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("Mean Distance to Wall",
                     "Median Distance to Wall",
                     "Prop Time Close to Wall"),
          hjust = -0.2,
          ncol = 3,
          nrow = 1)

```


















```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  filter(dist_to_other__mm > 2) %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  ggplot(aes(x=pos_x__px,y=pos_y__px)) +
    geom_point()
```






```{r}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=pos_x__px,y=pos_y__px)) +
    geom_point() +
    coord_fixed()
```





```{r}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_wall__mm > 1) %>% 
  ggplot(aes(x=pos_x__px,y=pos_y__px)) +
    geom_point() +
    coord_fixed()
```




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  #filter(dist_to_other__mm > 2) %>% 
  #filter(dist_to_wall__mm > 1) %>% 
  ggplot(aes(x=genotype,y=dist_to_wall__mm)) +
    geom_boxplot() +
  ylim(0,10)
p2 <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(dist_to_wall__mm > 1) %>% 
  ggplot(aes(x=genotype,y=dist_to_wall__mm)) +
    geom_boxplot() +
  ylim(0,10)
p3 <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  #filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_wall__mm > 1) %>% 
  ggplot(aes(x=genotype,y=dist_to_wall__mm)) +
    geom_boxplot() +
  ylim(0,10)
p4 <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_wall__mm > 1) %>% 
  ggplot(aes(x=genotype,y=dist_to_wall__mm)) +
    geom_boxplot() +
  ylim(0,10)
ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("all frames",
                     "non cop frames",
                     "gt 1mm from wall",
                     "non cop, gt 1mm"),
          hjust = -0.4,
          ncol = 4,
          nrow = 1)

```


































<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "A") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=dist_to_other__mm,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,2) +
    xlim(0,20)
```




<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "B") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=dist_to_other__mm,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,2) +
    xlim(0,20)
```


<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "C") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=dist_to_other__mm,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,2) +
    xlim(0,20)
```





<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(genotype == "D") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  ggplot(aes(x=dist_to_other__mm,colour=individual)) +
    geom_density() + theme(legend.position = "none") +
    ylim(0,2) +
    xlim(0,20)
```




<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  summarise(mean_dist_to_other = mean(dist_to_other__mm))


```



<br/>
<br/>


<br/>
<br/>



### **mean distance to other**

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_dist_to_other = mean(dist_to_other__mm),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_dist_to_other)) +
    geom_boxplot() +
    ylim(0,10)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_dist_to_other = mean(dist_to_other__mm),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_dist_to_other)) +
    geom_boxplot() +
    ylim(0,10)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_dist_to_other = mean(dist_to_other__mm),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_dist_to_other)) +
    geom_boxplot() +
    ylim(0,10)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("All Frames","Wing Extension Frames","Non-Wing Extension Frames"),
          #hjust = 1,
          ncol = 3,
          nrow = 1)

```


<br/>
<br/>


<br/>
<br/>



### **median distance to other**

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_dist_to_other = median(dist_to_other__mm),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_dist_to_other)) +
    geom_boxplot() +
    ylim(0,10)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_dist_to_other = median(dist_to_other__mm),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_dist_to_other)) +
    geom_boxplot() +
    ylim(0,10)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_dist_to_other = median(dist_to_other__mm),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_dist_to_other)) +
    geom_boxplot() +
    ylim(0,10)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("All Frames","Wing Extension Frames","Non-Wing Extension Frames"),
          hjust = -0.4,
          ncol = 3,
          nrow = 1)

```






<br/>
<br/>


<br/>
<br/>




### **mean facing angle** 


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("All Frames","Wing Extension Frames","Non-Wing Extension Frames"),
          #hjust = 1,
          ncol = 3,
          nrow = 1)

```










<br/>
<br/>


<br/>
<br/>




### **median facing angle**



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("All Frames","Wing Extension Frames","Non-Wing Extension Frames"),
          #hjust = 1,
          ncol = 3,
          nrow = 1)

```



<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,1.5)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,1)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,2)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("All Frames","Wing Extension Frames","Non-Wing Extension Frames"),
          #hjust = 1,
          ncol = 3,
          nrow = 1)

```



<br/>
<br/>



```{r}
test_stat_tibble0 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype))
```

```{r}
aov0 <- aov(median_facing_angle~genotype,data = test_stat_tibble0)
summary(aov0)
```

```{r}
TukeyHSD(aov0)
```



<br/>
<br/>


<br/>
<br/>



### **median facing angle by sector**


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad < pi/6) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad < pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi/6)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad < pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi/6)
p4 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p5 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p6 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(median_facing_angle = median(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=median_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
ggarrange(plotlist = list(p1,p2,p3,p4,p5,p6),
          labels = c("All Frames","Wing Extension Frames","Non-Wing Extension Frames"),
          #hjust = 1,
          ncol = 3,
          nrow = 2)

```



<br/>
<br/>


<br/>
<br/>


### **mean facing angle by sector**

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad < pi/6) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad < pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi/6)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad < pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi/6)
p4 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  #filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p5 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
p6 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() +
    ylim(0,pi)
ggarrange(plotlist = list(p1,p2,p3,p4,p5,p6),
          labels = c("All Frames","Wing Extension Frames","Non-Wing Extension Frames"),
          #hjust = 1,
          ncol = 3,
          nrow = 2)

```




<br/>
<br/>


<br/>
<br/>



### **mean facing angle by wee sectors**

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 0) %>% 
  filter(facing_angle__rad <= pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  filter(facing_angle__rad <= 2*pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 2*pi/6) %>% 
  filter(facing_angle__rad <= 3*pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p4 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 3*pi/6) %>% 
  filter(facing_angle__rad <= 4*pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() #+
    #ylim(0,pi)
p5 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 4*pi/6) %>% 
  filter(facing_angle__rad <= 5*pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() #+
    #ylim(0,pi)
p6 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 5*pi/6) %>% 
  filter(facing_angle__rad <= 6*pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(mean_facing_angle = mean(facing_angle__rad),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=mean_facing_angle)) +
    geom_boxplot() #+
    #ylim(0,pi)
ggarrange(plotlist = list(p1,p2,p3,p4,p5,p6),
          labels = c("0-pi/6","pi/6-2pi/6","2pi/6-3pi/6",
                     "3pi/6-4pi/6","4pi/6-5pi/6","5pi/6-6pi/6"),
          #hjust = 1,
          ncol = 3,
          nrow = 2)

```








<br/>
<br/>


<br/>
<br/>






### **counts in wee sectors**

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 0) %>% 
  filter(facing_angle__rad <= pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/6) %>% 
  filter(facing_angle__rad <= 2*pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 2*pi/6) %>% 
  filter(facing_angle__rad <= 3*pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p4 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 3*pi/6) %>% 
  filter(facing_angle__rad <= 4*pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi)
p5 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 4*pi/6) %>% 
  filter(facing_angle__rad <= 5*pi/6) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi)
p6 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 5*pi/6) %>% 
  filter(facing_angle__rad <= 6*pi/6) %>% 
  filter(max_wing_ang__rad < (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi)
ggarrange(plotlist = list(p1,p2,p3,p4,p5,p6),
          labels = c("0-pi/6","pi/6-2pi/6","2pi/6-3pi/6",
                     "3pi/6-4pi/6","4pi/6-5pi/6","5pi/6-6pi/6"),
          #hjust = 1,
          ncol = 3,
          nrow = 2)

```





<br/>
<br/>


<br/>
<br/>


#### **Total time in sector**


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > 0) %>% 
  filter(facing_angle__rad <= pi/8) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(facing_angle__rad > pi/8) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
ggarrange(plotlist = list(p1,p2),
          labels = c("<pi/8",">pi/8"),
          hjust = -0.6,
          vjust = 2,
          ncol = 2,
          nrow = 1)

```



<br/>
<br/>


<br/>
<br/>


#### **Proportion time in sector**

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = 100*sum(facing_angle__rad <= pi/8)/length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = 100*sum(facing_angle__rad > pi/8)/length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
ggarrange(plotlist = list(p1,p2),
          labels = c("<pi/8",">pi/8"),
          hjust = -1.4,
          vjust = 2,
          ncol = 2,
          nrow = 1)

```


<br/>
<br/>


```{r}
test_stat_tibble0 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad > pi/8)/length(Frame),
            genotype = unique(genotype))
aov0 <- aov(counts~genotype,data = test_stat_tibble0)
#summary(aov0)
TukeyHSD(aov0)
```



<br/>
<br/>



```{r}
pairwise.t.test(test_stat_tibble0$counts, test_stat_tibble0$genotype)
```













<br/>
<br/>





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  coord_polar() +
  theme_void()

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  coord_polar() +
  theme_void()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  coord_polar() +
  theme_void()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  coord_polar() +
  theme_void()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```


<br/>
<br/>


<br/>
<br/>


#### Total time in sector

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(facing_angle__rad > 0) %>% 
  filter(facing_angle__rad <= pi/8) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(facing_angle__rad > pi/8) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
ggarrange(plotlist = list(p1,p2),
          labels = c("<pi/8",">pi/8"),
          hjust = -0.6,
          vjust = 2,
          ncol = 2,
          nrow = 1)

```



<br/>
<br/>


<br/>
<br/>


#### Proportion time in sector and within 10mm

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = 100*sum(facing_angle__rad <= pi/8)/length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = 100*sum(facing_angle__rad > pi/8)/length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
ggarrange(plotlist = list(p1,p2),
          labels = c("<pi/8",">pi/8"),
          hjust = -1.4,
          vjust = 2,
          ncol = 2,
          nrow = 1)

```


<br/>
<br/>




```{r}
test_stat_tibble0 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad > pi/8)/length(Frame),
            genotype = unique(genotype))
aov0 <- aov(counts~genotype,data = test_stat_tibble0)
#summary(aov0)
TukeyHSD(aov0)
```

<br/>
<br/>


```{r}
pairwise.t.test(test_stat_tibble0$counts, test_stat_tibble0$genotype)
```


<br/>
<br/>


<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(0,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(0,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(0,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(0,2000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```



<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(4,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(4,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(4,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(4,2000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```


<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(40,10)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(50,50000),na.value = "white") +
  theme_void() +
  coord_polar()

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(40,10)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(50,50000),na.value = "white") +
  theme_void() +
  coord_polar()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(40,10)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(50,50000),na.value = "white") +
  theme_void() +
  coord_polar()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(40,10)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(50,50000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```





<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(100,25)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(10,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(100,25)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(10,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(100,25)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(10,2000),na.value = "white") +
  theme_void() +
  coord_polar()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(100,25)) +
  xlim(0,2*pi) +
  ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(10,2000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```




















<br/>
<br/>








```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", colour="white") +
  xlim(0,2*pi) +
  ylim(0,6) + 
  #scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_grey() +
  coord_polar()
  

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", colour="white") +
  xlim(0,2*pi) +
  ylim(0,6) + 
  #scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_grey() +
  coord_polar()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", colour="white") +
  xlim(0,2*pi) +
  ylim(0,6) + 
  #scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_grey() +
  coord_polar()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", colour="white") +
  xlim(0,2*pi) +
  ylim(0,6) + 
  #scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_grey() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```


<br/>
<br/>


<br/>
<br/>


#### Total count in inner ring



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(facing_angle__rad <= pi/8) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm <= 3) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(facing_angle__rad <= pi/8) %>% 
  filter(dist_to_other__mm > 3) %>% 
  filter(dist_to_other__mm <= 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
ggarrange(plotlist = list(p1,p2),
          labels = c("2mm-3mm","3mm-10mm"),
          hjust = -0.6,
          vjust = 2,
          ncol = 2,
          nrow = 1)

```




<br/>
<br/>


<br/>
<br/>


#### Proportion count in inner ring

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(facing_angle__rad <= pi/8) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = 100*sum(dist_to_other__mm > 2 & dist_to_other__mm <= 3)/length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  filter(facing_angle__rad <= pi/8) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  unite("individual", FileName:Id, remove = FALSE) %>% 
  group_by(individual) %>% 
  summarise(counts = 100*sum(dist_to_other__mm > 3 & dist_to_other__mm <= 10)/length(Frame),
            genotype = unique(genotype)) %>% 
  ggplot(aes(x=genotype, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
ggarrange(plotlist = list(p1,p2),
          labels = c("2mm-3mm","3mm-10mm"),
          hjust = -0.6,
          vjust = 2,
          ncol = 2,
          nrow = 1)

```




<br/>
<br/>


```{r}
test_stat_tibble0 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  filter(facing_angle__rad <= pi/8) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(dist_to_other__mm > 2 & dist_to_other__mm <= 3)/length(Frame),
            genotype = unique(genotype))
aov0 <- aov(counts~genotype,data = test_stat_tibble0)
#summary(aov0)
TukeyHSD(aov0)
```

















<br/>
<br/>


<br/>
<br/>


<br/>
<br/>




# Left vs Right wing



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            wing_index = 100*sum(WingGesture[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]
                                 )/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]
                     )) %>% 
  ggplot(aes(x=genotype,y=wing_index)) +
    geom_boxplot()
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            wing_index = 100*sum(max_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]>(35*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        (which.max(SmoothedCourtship)+(25*600))),
                                                                                  (which.max(SmoothedCourtship)+(25*600))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=wing_index)) +
    geom_boxplot()
ggarrange(plotlist = list(p1,p2),
          labels = c("JAABA","wing angle"),
          hjust = -0.6,
          vjust = 2,
          ncol = 2,
          nrow = 1)

```




<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=10, fig.height=8}
all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            Wing_index_by_JAABA = 100*sum(WingGesture[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                                 )/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     ),
            Wing_index_by_angle = 100*sum(max_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(35*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=Wing_index_by_angle,y=Wing_index_by_JAABA,colour=genotype)) +
    geom_point() +
    geom_smooth(method=lm) +
    stat_cor(label.y = c(52,56,60,64), size =5) +
    stat_regline_equation(label.y = c(50,54,58,62), size =5) +
    coord_fixed()
```







<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=10, fig.height=10}
wind <- 600
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            wing_index = 100*sum(max_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(35*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>% 
  ggplot(aes(x=genotype,y=wing_index)) +
    geom_boxplot()
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            left_wing_index = 100*sum(wing_l_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]<(-35*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=left_wing_index)) +
    geom_boxplot()
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            right_wing_index = 100*sum(wing_r_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(35*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=right_wing_index)) +
    geom_boxplot()
p4 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            both_wing_index = 100*sum(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(35*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=both_wing_index)) +
    geom_boxplot()
ggarrange(plotlist = list(p1,p4,p2,p3),
          labels = c("either wing","both wings","left wing","right wing"),
          hjust = -0.6,
          vjust = 2,
          ncol = 2,
          nrow = 2)
```


<br/>
<br/>



```{r}
test_stat_tibble <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  #filter(genotype != "A") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            both_wing_index = 100*sum(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(35*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     ))
aov1 <- aov(both_wing_index~genotype, data = test_stat_tibble)
TukeyHSD(aov1)
```


<br/>
<br/>


<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
wind <- 600
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            both_wing_index = 100*sum(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(10*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>% 
  ggplot(aes(x=genotype,y=both_wing_index)) +
    geom_boxplot()
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            both_wing_index = 100*sum(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(20*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=both_wing_index)) +
    geom_boxplot()
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            both_wing_index = 100*sum(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(30*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=both_wing_index)) +
    geom_boxplot()
p4 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            both_wing_index = 100*sum(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(40*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=both_wing_index)) +
    geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c(">10deg",">20deg",">30deg",">40deg"),
          hjust = -0.6,
          vjust = 2,
          ncol = 4,
          nrow = 1)
```


<br/>
<br/>









<br/>
<br/>



```{r}
test_stat_tibble <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  #filter(genotype != "A") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            both_wing_index = 100*sum(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(15*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     ))
aov1 <- aov(both_wing_index~genotype, data = test_stat_tibble)
TukeyHSD(aov1)
```



<br/>
<br/>


<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
wind <- 600
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            mean_max_wing = mean(max_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ])
            ) %>% 
  ggplot(aes(x=genotype,y=mean_max_wing)) +
    geom_boxplot() +
    ylim(0,1.5)
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            mean_left_wing = -mean(wing_l_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ],na.rm = TRUE)
            ) %>%
  ggplot(aes(x=genotype,y=mean_left_wing)) +
    geom_boxplot() +
    ylim(0,1.5)
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            mean_right_wing = mean(wing_r_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ],na.rm = TRUE)
            ) %>%
  ggplot(aes(x=genotype,y=mean_right_wing)) +
    geom_boxplot() +
    ylim(0,1.5)
p4 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            mean_min_wing = mean(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ])
            ) %>%
  ggplot(aes(x=genotype,y=mean_min_wing)) +
    geom_boxplot() +
    ylim(0,1.5)
ggarrange(plotlist = list(p1,p4,p2,p3),
          labels = c("max wing","min wings","left wing","right wing"),
          hjust = -0.6,
          vjust = 2,
          ncol = 4,
          nrow = 1)
```






<br/>
<br/>



```{r}
all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            mean_min_wing = mean(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ])
            ) %>%
  ggplot(aes(x=genotype,y=mean_min_wing)) +
    geom_boxplot() +
    ylim(0,.5)
```




<br/>
<br/>



```{r}
all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            min_wing_gt_15 = sum(mean(min_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ])>15*pi/180)
            ) %>% 
  summarise(tot_min_wing_gt_15 = sum(min_wing_gt_15>0,na.rm = TRUE),
            prop_min_wing_gt_15 = 100*sum(min_wing_gt_15>0,na.rm = TRUE)/length(min_wing_gt_15))
```











<br/>
<br/>


<br/>
<br/>






```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=-wing_l_ang__rad, y=wing_l_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=-wing_l_ang__rad, y=wing_l_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=-wing_l_ang__rad, y=wing_l_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=-wing_l_ang__rad, y=wing_l_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```

<br/>
<br/>


<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot(aes(x=wing_r_ang__rad, y=wing_r_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot(aes(x=wing_r_ang__rad, y=wing_r_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot(aes(x=wing_r_ang__rad, y=wing_r_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot(aes(x=wing_r_ang__rad, y=wing_r_len__px)) +
  geom_bin2d(bins = c(200,50)) +
  xlim(0,2*pi) +
  ylim(0,40) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```











<br/>
<br/>


<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()
p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()
p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()
p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)
```













```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad < (2*pi/3)) %>%
  filter(min_wing_ang__rad > (0)) %>%
  filter(wing_l_ang__rad > (-2*pi/3)) %>%
  filter(wing_r_ang__rad < (2*pi/3)) %>%
  filter(wing_l_ang__rad < (0)) %>%
  filter(wing_r_ang__rad > (0)) %>%
  filter(dist_to_wall__mm > 2) %>%
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,500),na.value = "white") +
  theme_void() +
  coord_polar()
p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad < (2*pi/3)) %>%
  filter(min_wing_ang__rad > (0)) %>%
  filter(wing_l_ang__rad > (-2*pi/3)) %>%
  filter(wing_r_ang__rad < (2*pi/3)) %>%
  filter(wing_l_ang__rad < (0)) %>%
  filter(wing_r_ang__rad > (0)) %>%
  filter(dist_to_wall__mm > 2) %>%
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,500),na.value = "white") +
  theme_void() +
  coord_polar()
p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad < (2*pi/3)) %>%
  filter(min_wing_ang__rad > (0)) %>%
  filter(wing_l_ang__rad > (-2*pi/3)) %>%
  filter(wing_r_ang__rad < (2*pi/3)) %>%
  filter(wing_l_ang__rad < (0)) %>%
  filter(wing_r_ang__rad > (0)) %>%
  filter(dist_to_wall__mm > 2) %>%
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,500),na.value = "white") +
  theme_void() +
  coord_polar()
p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad < (2*pi/3)) %>%
  filter(min_wing_ang__rad > (0)) %>%
  filter(wing_l_ang__rad > (-2*pi/3)) %>%
  filter(wing_r_ang__rad < (2*pi/3)) %>%
  filter(wing_l_ang__rad < (0)) %>%
  filter(wing_r_ang__rad > (0)) %>%
  filter(dist_to_wall__mm > 2) %>%
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot() +
  geom_bin2d(aes(x=wing_r_ang__rad, y=wing_r_len__px), bins = c(200,50)) +
  geom_bin2d(aes(x=wing_l_ang__rad, y=wing_l_len__px), bins = c(200,50)) +
  xlim(-pi,pi) +
  ylim(0,60) + 
  scale_fill_continuous(type = "viridis",limits = c(0,500),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)
```











<br/>
<br/>


<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "A") %>% 
  ggplot() +
  stat_density_2d(aes(x=wing_r_ang__rad, y=wing_r_len__px,fill = ..level..), geom = "polygon") +
  stat_density_2d(aes(x=wing_l_ang__rad, y=wing_l_len__px,fill = ..level..), geom = "polygon") +
  xlim(-pi,pi) +
  ylim(0,60) + 
  #scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()
p2 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "B") %>% 
  ggplot() +
  stat_density_2d(aes(x=wing_r_ang__rad, y=wing_r_len__px,fill = ..level..), geom = "polygon") +
  stat_density_2d(aes(x=wing_l_ang__rad, y=wing_l_len__px,fill = ..level..), geom = "polygon") +
  xlim(-pi,pi) +
  ylim(0,60) + 
  #scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()
p3 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "C") %>% 
  ggplot() +
  stat_density_2d(aes(x=wing_r_ang__rad, y=wing_r_len__px,fill = ..level..), geom = "polygon") +
  stat_density_2d(aes(x=wing_l_ang__rad, y=wing_l_len__px,fill = ..level..), geom = "polygon") +
  xlim(-pi,pi) +
  ylim(0,60) + 
  #scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()
p4 <- all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(min_wing_ang__rad > (15*pi/180)) %>%
  filter(genotype == "D") %>% 
  ggplot() +
  stat_density_2d(aes(x=wing_r_ang__rad, y=wing_r_len__px,fill = ..level..), geom = "polygon") +
  stat_density_2d(aes(x=wing_l_ang__rad, y=wing_l_len__px,fill = ..level..), geom = "polygon") +
  xlim(-pi,pi) +
  ylim(0,60) + 
  #scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)
```
















































<br/>
<br/>


<br/>
<br/>







```{r}
all_rawdata %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(dist_to_other__mm < 10) %>% 
  filter(max_wing_ang__rad > (25*pi/180)) %>%
  #filter(genotype == "D") %>% 
  ggplot(aes(x=genotype, y=wing_l_len__px))+
  geom_boxplot()
```





<br/>
<br/>


<br/>
<br/>


<br/>
<br/>


# **Facing angle at start vs end of wing bout**


<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>%
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(25*pi/180),1.6,-1)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.8,WingGesture-1)))) +
    #geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.6,WingGesture-1)))) +
  ylim(0,2)
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6") %>% 
  filter(Id == 7) %>%
  slice(which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                             ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)),
                                                    which.max(SmoothedCopulation),
                                                    min((which.max(SmoothedCourtship)+(25*600)),max(Frame))
                                                    ),
                                              min((which.max(SmoothedCourtship)+(25*600)),max(Frame))
                                              )) %>%
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),1.6,-1)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.8,WingGesture-1)))) +
    #geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.6,WingGesture-1)))) +
  ylim(0,2)
```



<br/>
<br/>


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 5) %>%
  slice(which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                             ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)),
                                                    which.max(SmoothedCopulation),
                                                    min((which.max(SmoothedCourtship)+(25*600)),max(Frame))
                                                    ),
                                              min((which.max(SmoothedCourtship)+(25*600)),max(Frame))
                                              )) %>%
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),1.6,-1)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.8,WingGesture-1)))) +
    #geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.6,WingGesture-1)))) +
  ylim(0,2)
```










<br/>
<br/>


<br/>
<br/>







### **Facing angle at start and end of each bout**




```{r}
temp <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  filter(dist_to_other__mm > 2)
  
uniq_fly <- unique(temp$unique_fly)
facing_start_and_end_wing <- tibble()
for (fly in uniq_fly) {
  temp2 <- filter(temp, unique_fly == fly)
  bouts <- rle(temp2$WingGesture)
  
  starts <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    starts[i] = sum(bouts$lengths[1:(i*2)-1])+1
  }
  ends <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    ends[i] = sum(bouts$lengths[1:(i*2)])
  }
  genotype = rep(unique(temp2$genotype),length(which(bouts$values==1)))
  uni_id = rep(unique(temp2$unique_fly),length(which(bouts$values==1)))
  
  temp_tibble <- tibble(unique_fly = uni_id,
                        genotype = genotype,
                        facing_at_start = temp2$facing_angle__rad[starts],
                        facing_at_end = temp2$facing_angle__rad[ends]
                        )
  facing_start_and_end_wing <- bind_rows(facing_start_and_end_wing,temp_tibble)
}
facing_start_and_end_wing
```



<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start)) +
  geom_boxplot()
p2 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_end)) +
  geom_boxplot()
p3 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start/facing_at_end)) +
  geom_boxplot() +
  ylim(0,2)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("Facing Angle at Start","Facing Angle at End","Ratio start:end"),
          hjust = -0.2,
          vjust = 1.6,
          ncol = 3,
          nrow = 1)

```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start-facing_at_end)) +
  geom_boxplot()+
  ylim(-0.5,0.5)
p2 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_end-facing_at_start)) +
  geom_boxplot()+
  ylim(-0.5,0.5)
p3 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start/facing_at_end)) +
  geom_boxplot() +
  ylim(0,2)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("Start-End","End-Start","Ratio start:end"),
          hjust = -0.2,
          vjust = 1.6,
          ncol = 3,
          nrow = 1)
```








<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start)) +
  geom_violin()
p2 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_end)) +
  geom_violin()
ggarrange(plotlist = list(p1,p2),
          labels = c("Facing Angle at Start","Facing Angle at End"),
          #hjust = -0.6,
          #vjust = 2,
          ncol = 2,
          nrow = 1)

```




<br/>
<br/>


<br/>
<br/>


<br/>
<br/>


### **Mean facing angle at start and end of bout**


```{r}
temp <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  filter(dist_to_other__mm > 2)
  
uniq_fly <- unique(temp$unique_fly)
facing_start_and_end_wing <- tibble()
for (fly in uniq_fly) {
  temp2 <- filter(temp, unique_fly == fly)
  bouts <- rle(temp2$WingGesture)
  
  starts <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    starts[i] = sum(bouts$lengths[1:(i*2)-1])+1
  }
  ends <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    ends[i] = sum(bouts$lengths[1:(i*2)])
  }
  genotype = unique(temp2$genotype)
  uni_id = unique(temp2$unique_fly)
  
  temp_tibble <- tibble(unique_fly = uni_id,
                        genotype = genotype,
                        facing_at_start = mean(temp2$facing_angle__rad[starts]),
                        facing_at_end = mean(temp2$facing_angle__rad[ends])
                        )
  facing_start_and_end_wing <- bind_rows(facing_start_and_end_wing,temp_tibble)
}
facing_start_and_end_wing
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start)) +
  geom_boxplot() +
  ylim(0,1)
p2 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_end)) +
  geom_boxplot() +
  ylim(0,1)
ggarrange(plotlist = list(p1,p2),
          labels = c("mean Facing Angle at Start","mean Facing Angle at End"),
          #hjust = -0.6,
          #vjust = 2,
          ncol = 2,
          nrow = 1)

```




<br/>
<br/>


<br/>
<br/>


### **Median facing angle at start and end of bout (using WingGesture)**


```{r}
temp <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  filter(dist_to_other__mm > 2)
  
uniq_fly <- unique(temp$unique_fly)
facing_start_and_end_wing <- tibble()
for (fly in uniq_fly) {
  temp2 <- filter(temp, unique_fly == fly)
  bouts <- rle(temp2$WingGesture)
  
  starts <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    starts[i] = sum(bouts$lengths[1:(i*2)-1])+1
  }
  ends <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    ends[i] = sum(bouts$lengths[1:(i*2)])
  }
  genotype = unique(temp2$genotype)
  uni_id = unique(temp2$unique_fly)
  
  temp_tibble <- tibble(unique_fly = uni_id,
                        genotype = genotype,
                        facing_at_start = median(temp2$facing_angle__rad[starts]),
                        facing_at_end = median(temp2$facing_angle__rad[ends])
                        )
  facing_start_and_end_wing <- bind_rows(facing_start_and_end_wing,temp_tibble)
}
facing_start_and_end_wing
```




<br/>
<br/>



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(WingGesture==1) %>% 
  summarise(genotype = unique(genotype),
            median_facing = median(facing_angle__rad)) %>% 
  ggplot(aes(x=genotype,y=median_facing)) +
    geom_boxplot() +
    ylim(0,0.5)
p2 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start)) +
  geom_boxplot() +
  ylim(0,0.5)
p3 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_end)) +
  geom_boxplot() +
  ylim(0,0.5)
p4 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start/facing_at_end)) +
  geom_boxplot() #+
  #ylim(0,0.5)
ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("median Facing angle throughout","median at Start of each bout","median at End of each bout","ratio start:end"),
          hjust = -0.2,
          vjust = 2,
          ncol = 4,
          nrow = 1)
```


<br/>
<br/>


<br/>
<br/>



### **Median facing angle at start and end of bout (using >35deg)**


```{r}
temp <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  filter(dist_to_other__mm > 2)
  
uniq_fly <- unique(temp$unique_fly)
facing_start_and_end_wing <- tibble()
for (fly in uniq_fly) {
  temp2 <- filter(temp, unique_fly == fly)
  #bouts <- rle(temp2$WingGesture)
  temp2$bin_max_wing <- ifelse(temp2$max_wing_ang__rad >= (35*pi/180),1,0)
  temp2$bin_max_wing <- temp2$bin_max_wing %>% replace_na(0)
  bouts <- rle(temp2$bin_max_wing)

  starts <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    starts[i] = sum(bouts$lengths[1:(i*2)-1])+1
  }
  ends <- as.numeric()
  for (i in seq(1,length(which(bouts$values==1)),1)) {
    ends[i] = sum(bouts$lengths[1:(i*2)])
  }
  genotype = unique(temp2$genotype)
  uni_id = unique(temp2$unique_fly)
  
  temp_tibble <- tibble(unique_fly = uni_id,
                        genotype = genotype,
                        facing_at_start = median(temp2$facing_angle__rad[starts]),
                        facing_at_end = median(temp2$facing_angle__rad[ends])
                        )
  facing_start_and_end_wing <- bind_rows(facing_start_and_end_wing,temp_tibble)
}
facing_start_and_end_wing
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=8}
p1 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  summarise(genotype = unique(genotype),
            median_facing = median(facing_angle__rad)) %>% 
  ggplot(aes(x=genotype,y=median_facing)) +
    geom_boxplot() +
    ylim(0,0.5)
p2 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start)) +
  geom_boxplot() +
  ylim(0,0.5)
p3 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_end)) +
  geom_boxplot() +
  ylim(0,0.5)
p4 <- ggplot(facing_start_and_end_wing, aes(x=genotype,y=facing_at_start/facing_at_end)) +
  geom_boxplot() #+
  #ylim(0,0.5)
ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("median Facing angle throughout","median at Start of each bout","median at End of each bout","ratio start:end"),
          hjust = -0.2,
          vjust = 2,
          ncol = 4,
          nrow = 1)

```








<br/>
<br/>


<br/>
<br/>






### **Facing angles with wing extended using WingGesture**

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=6}
p1 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(WingGesture==1) %>% 
  ggplot(aes(x=genotype,y=facing_angle__rad)) +
    geom_boxplot() +
    ylim(0,1)
p2 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(WingGesture==1) %>% 
  summarise(genotype = unique(genotype),
            median_facing = median(facing_angle__rad)) %>% 
  ggplot(aes(x=genotype,y=median_facing)) +
    geom_boxplot() +
    ylim(0,1)
p3 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(WingGesture==1) %>% 
  summarise(genotype = unique(genotype),
            mean_facing = mean(facing_angle__rad)) %>% 
  ggplot(aes(x=genotype,y=mean_facing)) +
    geom_boxplot() +
    ylim(0,1)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("Facing Angle","median Facing Angle","mean Facing Angle"),
          #hjust = -0.6,
          #vjust = 2,
          ncol = 3,
          nrow = 1)
```



<br/>
<br/>


<br/>
<br/>




### **Facing angles with wing extended using max_wing>35**


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=6}
p1 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  ggplot(aes(x=genotype,y=facing_angle__rad)) +
    geom_boxplot() +
    ylim(0,1)
p2 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  summarise(genotype = unique(genotype),
            median_facing = median(facing_angle__rad)) %>% 
  ggplot(aes(x=genotype,y=median_facing)) +
    geom_boxplot() +
    ylim(0,1)
p3 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  summarise(genotype = unique(genotype),
            mean_facing = mean(facing_angle__rad)) %>% 
  ggplot(aes(x=genotype,y=mean_facing)) +
    geom_boxplot() +
    ylim(0,1)
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("Facing Angle","median Facing Angle","mean Facing Angle"),
          #hjust = -0.6,
          #vjust = 2,
          ncol = 3,
          nrow = 1)
```

  

<br/>
<br/>





```{r}
test_stat_tibble0 <- all_rawdata %>% 
  filter(genotype!="CS female") %>% 
  group_by(unique_fly) %>% 
  filter(dist_to_other__mm > 2) %>% 
  filter(max_wing_ang__rad > (35*pi/180)) %>%
  summarise(genotype = unique(genotype),
            facing = median(facing_angle__rad)) 
aov0 <- aov(facing~genotype,data = test_stat_tibble0)
#summary(aov0)
TukeyHSD(aov0)
```















<br/>
<br/>


<br/>
<br/>


<br/>
<br/>


<br/>
<br/>


<br/>
<br/>




```{r}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) 
```


```{r}
temp2 <- test

#bouts <- rle(temp2$WingGesture)
temp2$bin_max_wing <- ifelse(temp2$max_wing_ang__rad > (35*pi/180),1,0)
temp2$bin_max_wing <- temp2$bin_max_wing %>% replace_na(0)
bouts <- rle(temp2$bin_max_wing)

starts <- as.numeric()
for (i in seq(1,length(which(bouts$values==1)),1)) {
  starts[i] = sum(bouts$lengths[1:(i*2)-1])+1
}
ends <- as.numeric()
for (i in seq(1,length(which(bouts$values==1)),1)) {
  ends[i] = sum(bouts$lengths[1:(i*2)])
}
genotype = rep(unique(temp2$genotype),length(which(bouts$values==1)))
uni_id = rep(unique(temp2$unique_fly),length(which(bouts$values==1)))

temp_tibble <- tibble(unique_fly = uni_id,
                      genotype = genotype,
                      facing_at_start = temp2$facing_angle__rad[starts],
                      facing_at_end = temp2$facing_angle__rad[ends]
                      )
temp_tibble

```


```{r}
starts = for (i in seq(1,length(which(bouts$values==1)),1)) {
                                           starts[i] = sum(bouts$lengths[1:(i*2)-1])+1
                                         }
starts
```




```{r}

test$bin_max_wing <- ifelse(test$max_wing_ang__rad > (35*pi/180),1,0)
test$bin_max_wing <- test$bin_max_wing %>% replace_na(0)
#test$bin_max_wing
bouts <- rle(test$bin_max_wing)
bouts
```


```{r}
bouts <- rle(test$WingGesture)
bouts
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) 

test$bin_max_wing <- ifelse(test$max_wing_ang__rad > (35*pi/180),1,0)
test$bin_max_wing <- test$bin_max_wing %>% replace_na(0)

test %>% 
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(bin_max_wing==1,1.6,-1)))) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),1.8,-1)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+1,WingGesture-1)))) +
    ylim(0,2.2)
```

```{r}
sum(test$bin_max_wing[which.max(test$SmoothedCourtship):which.max(test$SmoothedCopulation)]==test$WingGesture[which.max(test$SmoothedCourtship):which.max(test$SmoothedCopulation)])
sum(test$bin_max_wing[which.max(test$SmoothedCourtship):which.max(test$SmoothedCopulation)]!=test$WingGesture[which.max(test$SmoothedCourtship):which.max(test$SmoothedCopulation)])
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_123_3") %>% 
  filter(Id == 1) 

test$bin_max_wing <- ifelse(test$max_wing_ang__rad > (35*pi/180),1,0)
test$bin_max_wing <- test$bin_max_wing %>% replace_na(0)

test %>% 
  #slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(bin_max_wing==1,1.6,-1)))) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),1.8,-1)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+1,WingGesture-1)))) +
    ylim(0,2.2)
```

```{r}
gg_color_hue(4)
```


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=6}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_123_3") %>% 
  filter(Id == 1) %>% 
  filter(dist_to_other__mm > 2)

test$bin_max_wing <- ifelse(test$max_wing_ang__rad >= (35*pi/180),1,0)
test$bin_max_wing <- test$bin_max_wing %>% replace_na(0)

test %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm, colour = "#F8766D")) +
    geom_point(aes(y=SmoothedDistToOther-1, colour = "#7CAE00")) +
    geom_point(aes(y=(SmoothedCopulation-2), colour= "#00BFC4")) +

    geom_point(aes(y=c(ifelse(bin_max_wing==1,-3,-10)))) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),-4,-10)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,-6,-10)))) +
    geom_point(aes(y=c(ifelse(SmoothedCourtship==1,20,-10)))) +
    ylim(-6,20)
```

```{r}
max(test$Frame)
```



```{r}
temp2 <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_123_3") %>% 
  filter(Id == 1) %>% 
  filter(dist_to_other__mm > 2)

#bouts <- rle(temp2$WingGesture)
temp2$bin_max_wing <- ifelse(temp2$max_wing_ang__rad >= (35*pi/180),1,0)
temp2$bin_max_wing <- temp2$bin_max_wing %>% replace_na(0)
bouts <- rle(test$bin_max_wing)

starts <- as.numeric()
for (i in seq(1,length(which(bouts$values==1)),1)) {
  starts[i] = sum(bouts$lengths[1:(i*2)-1])+1
}
ends <- as.numeric()
for (i in seq(1,length(which(bouts$values==1)),1)) {
  ends[i] = sum(bouts$lengths[1:(i*2)])
}
genotype = unique(temp2$genotype)
uni_id = unique(temp2$unique_fly)

temp_tibble <- tibble(unique_fly = uni_id,
                      genotype = genotype,
                      facing_at_start = median(temp2$facing_angle__rad[starts]),
                      facing_at_end = median(temp2$facing_angle__rad[ends])
                      )
temp_tibble
```





```{r}
bouts <- rle(test$bin_max_wing)
bouts
```


































```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_123_3") %>% 
  filter(Id == 21) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=SmoothedCourtship, colour = "#F8766D")) +
    geom_point(aes(y=(SmoothedCopulation+0.1), colour= "#00BFC4")) #+
    #xlim(2000,3000)
```











```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>%
  #slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4"))
  
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>%
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.6,WingGesture-0.2))))
```

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>%
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+0.6,NA))))
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  ggplot(aes(x=Frame,y=dist_to_other__mm)) +
    geom_point(aes(colour=c(ifelse(SmoothedDistToOther>0.5,"not copulating","copulating"))))+
    geom_point(aes(y=c(ifelse(SmoothedCopulation==1,SmoothedCopulation+6,NA))))
```





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=SmoothedDistToOther, colour = "#F8766D")) +
    geom_point(aes(y=(SmoothedCopulation+0.1), colour= "#00BFC4")) +
    xlim(2000,3000)
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=SmoothedCourtship, colour = "#F8766D")) +
    geom_point(aes(y=(SmoothedCopulation+0.1), colour= "#00BFC4")) #+
    #xlim(2000,3000)
```












































































































































































































# **Trying to make functions for courtship window and calculate indices... they aren't working right, and seem to be ignoring the grouping of the tibble and returning the same value for every individual...**

If i have to for loop over the groups of a tibble, the below line might be usefull.
dim(unique(all_rawdata[all_rawdata %>% group_by(genotype) %>% group_vars()]))[1]






```{r}
courtship_window <- function(input,wind=600,...){
  temp_tibble <- summarise(input, start_of_courtship = which.max(SmoothedCourtship),
                                  end_of_courtship = ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                             ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                    which.max(SmoothedCopulation), 
                                                                    min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                    ),
                                                              min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                              )
                        )
  return(temp_tibble$start_of_courtship:temp_tibble$end_of_courtship)
  #return(c(temp_tibble$start_of_courtship,temp_tibble$end_of_courtship))
  #return(temp_tibble)
}
```


```{r}
courtship_window <- function(input,wind=600,...){
  temp_tibble <- summarise(input, start_of_courtship = which.max(SmoothedCourtship),
                                  end_of_courtship = ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                             ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                    which.max(SmoothedCopulation), 
                                                                    min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                    ),
                                                              min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                              )
                        )
  #return(temp_tibble$start_of_courtship:temp_tibble$end_of_courtship)
  return(c(temp_tibble$start_of_courtship,temp_tibble$end_of_courtship))
  #return(temp_tibble)
}
```








```{r}
courtship_window(test, wind = 600)
```





```{r}
temp <- all_rawdata %>% 
  filter(genotype!="CS female")

uniq_fly <- unique(temp$unique_fly)
courting_frames <- tibble()
for (fly in uniq_fly) {
  temp2 <- temp %>% filter(unique_fly == fly) 
  temp2 <- slice(temp2, which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                             ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*wind)), 
                                                                    which.max(SmoothedCopulation), 
                                                                    min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                    ),
                                                              min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                              ))
  courting_frames <- bind_rows(courting_frames,temp2)
}
courting_frames
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=6}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_123_3") %>% 
  filter(Id == 1) %>% 
  filter(dist_to_other__mm > 2)

#test$bin_max_wing <- ifelse(test$max_wing_ang__rad >= (35*pi/180),1,0)
#test$bin_max_wing <- test$bin_max_wing %>% replace_na(0)

test %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm, colour = "#F8766D")) +
    geom_point(aes(y=SmoothedDistToOther-1, colour = "#7CAE00")) +
    geom_point(aes(y=(SmoothedCopulation-2), colour= "#00BFC4")) +

    #geom_point(aes(y=c(ifelse(bin_max_wing==1,-3,-10)))) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),-4,-10)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,-6,-10)))) +
    geom_point(aes(y=c(ifelse(SmoothedCourtship==1,20,-10)))) +
    ylim(-6,20)
```

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=6}
test <- courting_frames %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_123_3") %>% 
  filter(Id == 1) #%>% 
  #filter(dist_to_other__mm > 2)

#test$bin_max_wing <- ifelse(test$max_wing_ang__rad >= (35*pi/180),1,0)
#test$bin_max_wing <- test$bin_max_wing %>% replace_na(0)

test %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm, colour = "#F8766D")) +
    geom_point(aes(y=ifelse(SmoothedDistToOther==1,1,-10), colour = "#7CAE00")) +
    geom_point(aes(y=ifelse(SmoothedCopulation==0,-2,-10), colour= "#00BFC4")) +
    geom_point(aes(y=ifelse(Copulation==0,-1,-10), colour= "#00BFC4")) +

    #geom_point(aes(y=c(ifelse(bin_max_wing==1,-3,-10)))) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),-4,-10)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,-6,-10)))) +
    geom_point(aes(y=c(ifelse(SmoothedCourtship==1,20,-10)))) +
    geom_point(aes(y=c(ifelse(Courtship==1,18,-10)))) +
    ylim(-6,20)
```








```{r}

```


```{r}

```


```{r}

```

```{r}

```


```{r}

```








```{r}
calculate_indices <- function(input = .,feature,jaaba=TRUE,thresh=NULL,wind=600){
  if (feature %in% names(input)) {
    var_ind = paste0(feature,"_index")
    if (jaaba) {
      temp_tibble <- summarise(input, genotype = unique(genotype), 
                                      !!var_ind := 100*sum(input[[feature]][which.max(input[["SmoothedCourtship"]]):ifelse(which.max(input[["SmoothedCopulation"]]) > which.max(input[["SmoothedCourtship"]]),
                                                       ifelse(which.max(input[["SmoothedCopulation"]]) <= (which.max(input[["SmoothedCourtship"]])+(25*wind)), 
                                                              which.max(input[["SmoothedCopulation"]]), 
                                                              min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                              ),
                                                        min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                        )])/
                                                    length(input[["Frame"]][which.max(input[["SmoothedCourtship"]]):ifelse(which.max(input[["SmoothedCopulation"]]) > which.max(input[["SmoothedCourtship"]]),
                                                       ifelse(which.max(input[["SmoothedCopulation"]]) <= (which.max(input[["SmoothedCourtship"]])+(25*wind)), 
                                                              which.max(input[["SmoothedCopulation"]]), 
                                                              min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                              ),
                                                        min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                        )])
                )
    } else {
      temp_tibble <- summarise(input, genotype = unique(genotype), 
                                      !!var_ind := 100*sum(input[[feature]][which.max(input[["SmoothedCourtship"]]):ifelse(which.max(input[["SmoothedCopulation"]]) > which.max(input[["SmoothedCourtship"]]),
                                                       ifelse(which.max(input[["SmoothedCopulation"]]) <= (which.max(input[["SmoothedCourtship"]])+(25*wind)), 
                                                              which.max(input[["SmoothedCopulation"]]), 
                                                              min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                              ),
                                                        min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                        )]>thresh,na.rm = TRUE)/
                                                    length(input[["Frame"]][which.max(input[["SmoothedCourtship"]]):ifelse(which.max(input[["SmoothedCopulation"]]) > which.max(input[["SmoothedCourtship"]]),
                                                       ifelse(which.max(input[["SmoothedCopulation"]]) <= (which.max(input[["SmoothedCourtship"]])+(25*wind)), 
                                                              which.max(input[["SmoothedCopulation"]]), 
                                                              min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                              ),
                                                        min((which.max(input[["SmoothedCourtship"]])+(25*wind)),max(input[["Frame"]]))
                                                        )])
                )
    }
    return(temp_tibble)
  } else {
    message(paste0(feature, " does not exist in table"))
  }
} 
```






```{r}
calculate_indices <- function(input,feature,jaaba=TRUE,thresh=NULL){
  if (feature %in% names(input)) {
    var_ind = paste0(feature,"_index")
    if (jaaba) {
      temp_tibble <- summarise(input, genotype = unique(genotype), 
                                      !!var_ind := 100*sum(input[[feature]][courtship_window(input)])/
                                                    length(input[["Frame"]][courtship_window(input)])
                )
    } else {
      temp_tibble <- summarise(input, genotype = unique(genotype), 
                                      !!var_ind := 100*sum(input[[feature]][courtship_window(input)]>thresh,na.rm = TRUE)/
                                                    length(input[["Frame"]][courtship_window(input)])
                )
    }
    return(temp_tibble)
  } else {
    message(paste0(feature, " does not exist in table"))
  }
} 
```





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(unique_fly) %>% 
  calculate_indices(feature = "max_wing_ang__rad",jaaba = FALSE,thresh = (25*pi/180)) %>% 
  ggplot(aes(x=genotype,y=max_wing_ang__rad_index)) +
    geom_boxplot()
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(unique_fly) %>% 
  calculate_indices(feature = "wing_l_ang__rad",jaaba = FALSE,thresh = (25*pi/180)) %>% 
  ggplot(aes(x=genotype,y=wing_l_ang__rad_index)) +
    geom_boxplot()
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(unique_fly) %>% 
  calculate_indices(feature = "wing_r_ang__rad",jaaba = FALSE,thresh = (25*pi/180)) %>% 
  ggplot(aes(x=genotype,y=wing_r_ang__rad_index)) +
    geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("wing index","left wing","right wing"),
          hjust = -0.6,
          vjust = 2,
          ncol = 3,
          nrow = 1)

```





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            wing_index = 100*sum(max_wing_ang__rad[courtship_window(input)]>(40*pi/180),
                                 na.rm = TRUE)/
              length(Frame[courtship_window(input)]
                     )) %>% 
  ggplot(aes(x=genotype,y=wing_index)) +
    geom_boxplot()
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            left_wing_index = 100*sum(wing_l_ang__rad[courtship_window(input)]<(-40*pi/180),
                                 na.rm = TRUE)/
              length(Frame[courtship_window(input)]
                     )) %>%
  ggplot(aes(x=genotype,y=left_wing_index)) +
    geom_boxplot()
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            right_wing_index = 100*sum(wing_r_ang__rad[courtship_window(input)]>(40*pi/180),
                                 na.rm = TRUE)/
              length(Frame[courtship_window(input)]
                     )) %>%
  ggplot(aes(x=genotype,y=right_wing_index)) +
    geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("wing index","left wing","right wing"),
          hjust = -0.6,
          vjust = 2,
          ncol = 3,
          nrow = 1)

```








```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=4}
p1 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            wing_index = 100*sum(max_wing_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(40*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>% 
  ggplot(aes(x=genotype,y=wing_index)) +
    geom_boxplot()
p2 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            left_wing_index = 100*sum(wing_l_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]<(-40*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=left_wing_index)) +
    geom_boxplot()
p3 <- all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  summarise(genotype = unique(genotype),
            right_wing_index = 100*sum(wing_r_ang__rad[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]>(40*pi/180),
                                 na.rm = TRUE)/
              length(Frame[which.max(SmoothedCourtship):ifelse(which.max(SmoothedCopulation) > which.max(SmoothedCourtship),
                                                                                 ifelse(which.max(SmoothedCopulation) <= (which.max(SmoothedCourtship)+(25*600)), 
                                                                                        which.max(SmoothedCopulation), 
                                                                                        min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                        ),
                                                                                  min((which.max(SmoothedCourtship)+(25*wind)),max(Frame))
                                                                                  )
                                             ]
                     )) %>%
  ggplot(aes(x=genotype,y=right_wing_index)) +
    geom_boxplot()
ggarrange(plotlist = list(p1,p2,p3),
          labels = c("wing index","left wing","right wing"),
          hjust = -0.6,
          vjust = 2,
          ncol = 3,
          nrow = 1)
```










```{r}
all_rawdata %>% 
  filter(genotype != "CS female") %>% 
  filter(genotype == "D") %>% 
  group_by(genotype) %>% 
  group_by(unique_fly) %>% 
  calculate_indices(feature = "max_wing_ang__rad",jaaba = FALSE,thresh = (25*pi/180))
```






```{r}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) 
```


```{r}
calculate_indices(input = test,feature = "WingGesture",jaaba = TRUE)
```



```{r}
calculate_indices(input = test,feature = "max_wing_ang__rad",jaaba = FALSE,thresh = (25*pi/180))
```




```{r}
calculate_indices(input = test,feature = "max_wing_angle__rad",jaaba = FALSE,thresh = (25*pi/180))
```




























