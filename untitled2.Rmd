---
title: "R Notebook"
output: html_notebook
---








```{r}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 36) 
```





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
test %>% 
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=-wing_l_ang__rad, colour = "#F8766D")) +
    geom_point(aes(y=wing_r_ang__rad, colour = "#00BFC4")) +
    geom_point(aes(y=c(ifelse(bin_max_wing==1,1.6,-1)))) +
    geom_point(aes(y=c(ifelse(max_wing_ang__rad>=(35*pi/180),1.8,-1)))) +
    geom_point(aes(y=c(ifelse(WingGesture==1,WingGesture+1,WingGesture-1)))) +
    ylim(0,2.2)
```



```{r}
gg_color_hue(4)
```




# calculates relative y value based on data from feat.mat
calculate_yrel <- function(theta,dist){
  yrel=dist*cos(theta)
  return(yrel)
}



# function calculates xrel based on track.mat file
# in the case of the male, right and left wing angles were swapped, so in
# that case, the names of the arguments to the functions don't make sense.
# This is due to 'ipsi' and 'contra' having a different meaning when male
# position relative to female is examined.
# determining whether ipsi or contralateral wing is extended.
calculate_xrel <- function(ori,xmale,xfemale,right_angle,left_angle,yrel,ppm){
  xmale_mm=xmale/ppm;
  xfemale_mm=xfemale/ppm;
  
  if (abs(right_angle)>abs(left_angle)) {
    xrel = (xfemale_mm - (cos(ori)*yrel+xmale_mm))/(sin(ori))
  } else {
    xrel = -(xfemale_mm - (cos(ori)*yrel+xmale_mm))/(sin(ori))
  }
  
  if (xrel >20 | xrel<-20) {
    xrel=NA
  }
}




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
test %>% 
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=pos_y__px, colour = "#F8766D")) +
    geom_point(aes(y=pos_x__px, colour = "#619CFF"))

```





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
test %>% 
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm, colour = "#F8766D")) +
    geom_point(aes(y=(dist_to_other__mm*cos(facing_angle__rad)), colour = "#00BA38"))

```


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
test %>% 
  slice(which.max(SmoothedCourtship):which.max(SmoothedCopulation)) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm, colour = "#F8766D")) +
    geom_point(aes(y=(
      
      (xfemale_mm - (cos(ori)*yrel+xmale_mm))/(sin(ori))
      
    ), colour = "#00BA38"))

```




```{r}
test <- all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Arena == 1) %>% 
  filter(Frame == 1)
test
```



```{r}
test[1,]
```


```{r}
test[2,]
```


```{r}
test$dist_to_other__mm[1]
test$dist_to_other__mm[2]
```


```{r}
test$facing_angle__rad[1]
test$facing_angle__rad[2]
```


```{r}
test <- test %>%
  mutate(rel_x = ,
         rel_y = )
```






```{r}
new_data
```


```{r}
unique(new_data$FileName)
new_data <- new_data %>% 
  filter(FileName!="Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2")
unique(new_data$FileName)
```







```{r}
new_data %>% 
  filter(genotype!="CS female") %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_other,y=rel_y_other)) +
  geom_point() +
  coord_fixed()
```






```{r}
new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  # xlim(0,2*pi) +
  # ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(10,1000),na.value = "white") +
  # theme_void() +
  coord_fixed()
```



```{r}
new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  #filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  #filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  # xlim(0,2*pi) +
  # ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") #+
  # theme_void() +
  #coord_fixed()
```


```{r}
new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  #filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  #filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
   xlim(0,2*pi) +
  # ylim(0,10) + 
  geom_point()
  # theme_void() +
  #coord_fixed()
```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=8}
p1 <- new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=ifelse(rel_x_other>=0,rel_x_other,-rel_x_other),y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_fixed()
p2 <- new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(150,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2),
          labels = c("rel pos","polar"),
          hjust = -0.2,
          ncol = 2,
          nrow = 1)


```





```{r}
new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_x_other < -20 | rel_x_other > 20) %>% 
  select(FileName,Arena,Id,Frame,dist_to_other__mm,facing_angle__rad,ori__rad,pos_x__px,pos_y__px,rel_x_other,rel_y_other)
```


(xfemale_mm - (cos(ori)*yrel+xmale_mm))/(sin(ori))


```{r}
new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_x_other < -20 | rel_x_other > 20) %>% 
  select(Arena,Id,Frame,dist_to_other__mm,facing_angle__rad,ori__rad,pos_x__px,pos_y__px,rel_x_other,rel_y_other) %>% 
  mutate(cos_ori = cos(ori__rad),
         sin_ori = sin(ori__rad))
```



```{r}
new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_x_other < -20 | rel_x_other > 20) %>% 
  ggplot(aes(x=FileName,y=ori__rad))+geom_point()
```


```{r}
p1 <- new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_x_other < -20 | rel_x_other > 20) %>% 
  ggplot(aes(x=FileName,y=ori__rad))+geom_point()+ylim(-3.3,-2.8)
p2 <- new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_x_other < -20 | rel_x_other > 20) %>% 
  ggplot(aes(x=FileName,y=ori__rad))+geom_point()+ylim(-0.6,0.6)
p3 <- new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_x_other < -20 | rel_x_other > 20) %>% 
  ggplot(aes(x=FileName,y=ori__rad))+geom_point()+ylim(2.8,3.2)
ggarrange(plotlist = list(p1,p2,p3),
          ncol = 3,
          nrow = 1)
```







```{r}
new_data %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other < -20 | rel_y_other > 20)
```


































```{r}
temp2 %>% 
  filter(genotype=="A") %>% 
  #filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  #filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_other,y=rel_y_other)) +
  geom_point()
```






```{r}
temp2 %>% 
  filter(genotype=="A") %>% 
  #filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  #filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_abs_other,y=rel_y_other)) +
  geom_point() +
  coord_fixed()
```



```{r}
temp2 %>% 
  filter(genotype=="A") %>% 
  #filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  #filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_point() +
  coord_fixed()
```


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=18, fig.height=18}
temp2 %>% 
  filter(genotype=="A") %>%
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_fixed()
```



```{r}
temp2 %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  #filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  #filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  # xlim(0,2*pi) +
  # ylim(0,10) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") #+
  # theme_void() +
  #coord_fixed()
```





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=8}
p1 <- temp2 %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=ifelse(rel_x_other>=0,rel_x_other,-rel_x_other),y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_fixed()
p2 <- temp2 %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(150,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2),
          labels = c("rel pos","polar"),
          hjust = -0.2,
          ncol = 2,
          nrow = 1)


```


```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=8}
p1 <- temp2 %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_abs_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_fixed()
p2 <- temp2 %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(150,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2),
          labels = c("abs rel pos","polar"),
          hjust = -0.2,
          ncol = 2,
          nrow = 1)


```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=8}
p1 <- temp2 %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_fixed()
p2 <- temp2 %>% 
  filter(genotype!="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  filter(rel_y_other > -20 & rel_y_other < 20) %>% 
  filter(rel_x_other > -20 & rel_x_other < 20) %>% 
  ggplot(aes(x=facing_angle__rad, y=dist_to_other__mm)) +
  geom_bin2d(bins = c(150,50)) +
  xlim(0,2*pi) +
  ylim(0,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,1000),na.value = "white") +
  # theme_void() +
  coord_polar()

ggarrange(plotlist = list(p1,p2),
          labels = c("abs rel pos","polar"),
          hjust = -0.2,
          ncol = 2,
          nrow = 1)


```





```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=18, fig.height=18}
temp2 %>% 
  filter(genotype=="CS female") %>%
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  # scale_fill_continuous(type = "viridis",na.value = "white") +
  scale_fill_continuous(type = "viridis",limits = c(0,5000),na.value = "white") +
  # theme_void() +
  coord_fixed()
```

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="A") %>%
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(0,5000),na.value = "white") +
  # theme_void() +
  coord_fixed()

p2 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="B") %>%
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  # scale_fill_continuous(type = "viridis",na.value = "white") +
  scale_fill_continuous(type = "viridis",limits = c(0,5000),na.value = "white") +
  # theme_void() +
  coord_fixed()

p3 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="C") %>%
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  # scale_fill_continuous(type = "viridis",na.value = "white") +
  scale_fill_continuous(type = "viridis",limits = c(0,5000),na.value = "white") +
  # theme_void() +
  coord_fixed()

p4 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="D") %>%
  filter(dist_to_other__mm > 2) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  # scale_fill_continuous(type = "viridis",na.value = "white") +
  scale_fill_continuous(type = "viridis",limits = c(0,5000),na.value = "white") +
  # theme_void() +
  coord_fixed()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=12}
p1 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="A") %>%
  filter(dist_to_other__mm > 2.5) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_void() +
  coord_fixed()

p2 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="B") %>%
  filter(dist_to_other__mm > 2.5) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_void() +
  coord_fixed()

p3 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="C") %>%
  filter(dist_to_other__mm > 2.5) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_void() +
  coord_fixed()

p4 <- all_rawdata %>% 
  filter(sex=="female") %>%
  filter(treatment=="D") %>%
  filter(dist_to_other__mm > 2.5) %>% 
  ggplot(aes(x=rel_x_abs_corr_other,y=rel_y_other)) +
  geom_bin2d(bins = c(100,100)) +
  xlim(-20,20) +
  ylim(-20,20) + 
  scale_fill_continuous(type = "viridis",limits = c(2,2000),na.value = "white") +
  theme_void() +
  coord_fixed()

ggarrange(plotlist = list(p1,p2,p3,p4),
          labels = c("A","B","C","D"),
          #hjust = 1,
          ncol = 2,
          nrow = 2)

```










#### Proportion time in sector and within 10mm

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=8}
p1 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=0 & facing_angle__rad < 1*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=1*pi/8 & facing_angle__rad < 2*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p3 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=2*pi/8 & facing_angle__rad < 3*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p4 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=3*pi/8 & facing_angle__rad < 4*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p5 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=4*pi/8 & facing_angle__rad < 5*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p6 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=5*pi/8 & facing_angle__rad < 6*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p7 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=6*pi/8 & facing_angle__rad < 7*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p8 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=7*pi/8 & facing_angle__rad < 8*pi/8)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
ggarrange(plotlist = list(p1,p2,p3,p4,p5,p6,p7,p8),
          labels = c("0-pi/8","pi/8-2pi/8","2pi/8-3pi/8",
                     "3pi/8-4pi/8","4pi/8-5pi/8","5pi/8-6pi/8",
                     "6pi/8-7pi/8","7pi/8-pi"),
          #hjust = -1.4,
          #vjust = 2,
          ncol = 4,
          nrow = 2)

```








#### Proportion time in sector and within 10mm

```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=12, fig.height=6}
p1 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=0 & facing_angle__rad < 3*pi/4)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)
p2 <- all_rawdata %>% 
  filter(sex == "female") %>% 
  filter(!is.na(treatment)) %>% 
  filter(dist_to_other__mm > 2.5) %>% 
  #filter(dist_to_other__mm < 10) %>% 
  group_by(unique_fly) %>% 
  summarise(counts = 100*sum(facing_angle__rad>=3*pi/4 & facing_angle__rad < pi)/length(Frame),
            treatment = unique(treatment)) %>% 
  ggplot(aes(x=treatment, y=counts)) +
    geom_boxplot() #+
    #ylim(0,pi/6)



ggarrange(plotlist = list(p1,p2),
          labels = c("0-3pi/4","3pi/4-pi"),
          #hjust = -1.4,
          #vjust = 2,
          ncol = 2,
          nrow = 1)

```






















```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 35) %>%
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,color=gg_color_hue(2)[2]),size=1)
```



<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 37) %>%
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,color=gg_color_hue(2)[2]),size=1)
```







<br/>
<br/>




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6") %>% 
  filter(Id == 17) %>%
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,color=gg_color_hue(2)[2]),size=1)+
    geom_point(aes(y=c(ifelse(SmoothedCopulation==1,SmoothedCopulation+6,NA))))+
    geom_point(aes(y=c(ifelse(Copulation==1,Copulation+7,NA))))
```



colour=c(ifelse(rollavg_dist_to_other>2.5,gg_color_hue(2)[2],gg_color_hue(2)[1]))



```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6") %>% 
  filter(Id == 17) %>%
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,colour=c(ifelse(rollavg_dist_to_other>2.5,gg_color_hue(2)[2],gg_color_hue(2)[1]))),size=1)+
    geom_point(aes(y=c(ifelse(SmoothedCopulation==1,SmoothedCopulation+6,NA))))+
    geom_point(aes(y=c(ifelse(Copulation==1,Copulation+7,NA))))
```




```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 37) %>%
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,colour=c(ifelse(rollavg_dist_to_other>2.5,gg_color_hue(2)[2],gg_color_hue(2)[1]))),size=1)
```







  







```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 27) %>% 
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,colour=c(ifelse(rollavg_dist_to_other>2.5,gg_color_hue(2)[2],gg_color_hue(2)[1]))),size=1) +
    ylim(0,20)
```









```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_6") %>% 
  filter(Id == 17) %>%
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,colour=c(ifelse(rollavg_dist_to_other>2.5,gg_color_hue(2)[2],gg_color_hue(2)[1]))),size=1) +
    ylim(0,20)
```










```{r warning=FALSE, message=FALSE, echo=FALSE, fig.width=16, fig.height=4}
all_rawdata %>% 
  filter(FileName == "Megan-2019_03_06_Courtship-DsxVglutTNT_Male_1234_2") %>% 
  filter(Id == 29) %>% 
  mutate(rollavg_dist_to_other = rollmean(dist_to_other__mm, 200, fill = c(NA,0,NA), align = c("center"))) %>% 
  ggplot(aes(x=Frame)) +
    geom_point(aes(y=dist_to_other__mm,color=gg_color_hue(2)[1]))+
    geom_point(aes(y=rollavg_dist_to_other,colour=c(ifelse(rollavg_dist_to_other>2.5,gg_color_hue(2)[2],gg_color_hue(2)[1]))),size=1) +
    ylim(0,20)
```














































